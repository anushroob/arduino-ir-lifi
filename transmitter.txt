const int ledPin = 9;
int bitDelay = 50;  // âœ… Faster delay (50ms)
String message = "";

void setup() {
  pinMode(ledPin, OUTPUT);
  Serial.begin(9600);
  Serial.println("Enter message to send:");
}

void loop() {
  if (Serial.available()) {
    message = Serial.readStringUntil('\n');
    message.trim();  // Remove extra spaces/newline
    if (message.length() > 0) {
      Serial.print("Sending: ");
      Serial.println(message);
      sendMessage(message);
    }
  }
}

void sendMessage(String msg) {
  for (int i = 0; i < msg.length(); i++) {
    char c = msg.charAt(i);
    byte b = c;

    sendByte(b);
  }

  // Send end marker (255)
  sendByte(255);
}

void sendByte(byte b) {
  // Start pulse
  digitalWrite(ledPin, HIGH);  
  delay(bitDelay * 2);         
  digitalWrite(ledPin, LOW);
  delay(bitDelay);

  // Send bits (MSB first)
  for (int j = 7; j >= 0; j--) {
    digitalWrite(ledPin, bitRead(b, j) ? HIGH : LOW);
    delay(bitDelay);
  }

  digitalWrite(ledPin, LOW);
  delay(bitDelay * 2);
}
